{% extends "planner/layout.html" %}
{% load static %}

{% block title %}
    Magic Recipe
{% endblock %}

{% block body %}
<div class="container mx-auto max-w-2xl px-4 pb-8" x-data="{ recipeGenerated: false }">
    <!-- Back Link -->
    <a href="{% url 'recipes' %}" class="inline-flex items-center text-sm text-gray-600 hover:text-gray-900 mb-6">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
        Back to Recipes
    </a>

    <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900 mb-2">Magic Recipe</h1>
        <p class="text-gray-600 mt-2">Let our AI generate a recipe tailored to your preferences!</p>
    </div>

    <div class="magic-form-wrapper space-y-4">
        <form hx-post="{% url 'action_generate_recipe' %}" 
              hx-target="#generated-recipe"
              hx-swap="innerHTML"
              hx-push-url="true"
              hx-disabled-elt="#recipe-form-fieldset"
              x-on:htmx:after-swap.window="recipeGenerated = true"
              class="space-y-2">
            
            <fieldset id="recipe-form-fieldset">
                <!-- Recipe Idea Section -->
                <div class="mt-8 mb-6">
                    <h2 class="form-section-title">Recipe Idea</h2>
                    <div class="form-group">
                        {{ form.dish_idea.label_tag }}
                        {{ form.dish_idea }}
                    </div>
                    <div class="form-group">
                        {{ form.notes.label_tag }}
                        {{ form.notes }}
                    </div>
                </div>

                <!-- Profile Settings Section -->
                <div class="mt-8 mb-6">
                    <div class="pt-6 pb-2">
                        <h2 class="form-section-title">Preferences</h2>
                        <p class="text-sm text-gray-600 mt-1 inline">
                            Set default preferences in 
                            <a href="{% url 'profile' %}" class="text-violet-500 hover:text-violet-600">Profile</a>
                        </p>
                    </div>
                    
                    <div class="form-group">
                        {{ form.dietary_preferences.label_tag }}
                        {{ form.dietary_preferences }}
                    </div>
                    <div class="form-group">
                        {{ form.servings.label_tag }}
                        {{ form.servings }}
                    </div>
                    <div class="form-group">
                        {{ form.units.label_tag }}
                        {{ form.units }}
                    </div>
                </div>
                
                <!-- Generate Recipe Button -->
                <button type="submit" 
                        class="form-submit">
                    âœ¨ Generate Recipe
                </button>

                <!-- Loading Indicator -->
                <div class="htmx-indicator flex justify-center py-4">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-violet-500"></div>
                </div>
            </fieldset>
        </form>
    </div>

    <!-- Generated Recipe Controls -->
    <div id="generated-recipe-controls" x-show="recipeGenerated">

        <button class="save-recipe-button">Save to My Recipes</button>
        <button class="start-over-button" 
                hx-get="{% url 'magic_recipe' %}"
                hx-push-url="true"
                hx-target="body">Start Over</button>
    </div>

    <div id="generated-recipe">
        {% if id_in_url %}
            {% include "planner/partials/partial_recipe.html" with recipe=id_in_url %}
        {% endif %}
    </div>
</div>

{% endblock %}